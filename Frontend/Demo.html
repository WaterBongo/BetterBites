<!DOCTYPE html>
<html style="font-size: 16px" lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <title>BetterBites</title>
    <link rel="stylesheet" href="nicepage.css" media="screen" />
    <link rel="stylesheet" href="Demo.css" media="screen" />
    <script
      class="u-script"
      type="text/javascript"
      src="jquery.js"
      defer=""
    ></script>
    <script
      class="u-script"
      type="text/javascript"
      src="nicepage.js"
      defer=""
    ></script>
    <meta name="generator" content="Nicepage 5.7.9, nicepage.com" />
    <meta name="referrer" content="origin" />
    <link
      id="u-theme-google-font"
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i|Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
    />
    <link
      id="u-page-google-font"
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
    />

    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "name": "BetterBites"
      }
    </script>
    <meta name="theme-color" content="#4756c9" />
    <meta property="og:title" content="Demo" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="website" />
    <meta data-intl-tel-input-cdn-path="intlTelInput/" />
  </head>
  <body class="u-body u-xl-mode" data-lang="en">
    <header class="u-clearfix u-grey-90 u-header u-header" id="sec-03c7">
      <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <nav class="u-menu u-menu-one-level u-offcanvas u-menu-1">
          <div class="menu-collapse">
            <a class="u-button-style u-custom-text-color u-nav-link" href="#">
              <svg class="u-svg-link" viewBox="0 0 24 24">
                <use
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  xlink:href="#menu-hamburger"
                ></use>
              </svg>
              <svg
                class="u-svg-content"
                version="1.1"
                id="menu-hamburger"
                viewBox="0 0 16 16"
                x="0px"
                y="0px"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g>
                  <rect y="1" width="16" height="2"></rect>
                  <rect y="7" width="16" height="2"></rect>
                  <rect y="13" width="16" height="2"></rect>
                </g>
              </svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container">
            <ul
              class="u-custom-font u-font-montserrat u-nav u-unstyled u-nav-1"
            >
              <li class="u-nav-item">
                <a
                  class="u-button-style u-nav-link u-text-active-palette-3-base u-text-hover-palette-3-light-2 u-text-palette-3-light-1"
                  href="Home.html"
                  style="padding: 10px 20px"
                  >Home</a
                >
              </li>
              <li class="u-nav-item">
                <a
                  class="u-button-style u-nav-link u-text-active-palette-3-base u-text-hover-palette-3-light-2 u-text-palette-3-light-1"
                  href="Demo.html"
                  style="padding: 10px 20px"
                  >Demo</a
                >
              </li>
            </ul>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div
              class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav"
            >
              <div class="u-inner-container-layout u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul
                  class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2"
                >
                  <li class="u-nav-item">
                    <a class="u-button-style u-nav-link" href="Home.html"
                      >Home</a
                    >
                  </li>
                  <li class="u-nav-item">
                    <a class="u-button-style u-nav-link" href="Demo.html"
                      >Demo</a
                    >
                  </li>
                </ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
      </div>
    </header>
    <section class="u-clearfix u-grey-90 u-section-1" id="sec-1a0a">
      <div class="u-clearfix u-sheet u-sheet-1">
        <h1 class="u-align-center u-text u-title u-text-1">
          Find an alternative to your snack
        </h1>
        <div class="u-expanded-width u-form u-form-1">
          <form id="betterbites-form" style="padding: 10px">
            <div class="u-form-group u-form-name u-label-none">
              <label for="name-8fe3" class="u-label">Food</label>
              <input
                type="text"
                id="name-8fe3"
                name="food"
                class="u-grey-90 u-input u-input-rectangle u-radius-15 u-text-white u-input-1"
                required=""
                placeholder="Name of food"
              />
            </div>
            <div
              class="u-form-checkbox-group u-form-group u-form-input-layout-horizontal u-label-none u-form-group-2"
            >
              <label class="u-label">Options</label>
              <div class="u-form-checkbox-group-wrapper">
                <div class="u-input-row">
                  <input
                    id="field-e7f9"
                    type="checkbox"
                    name="options[]"
                    value="false"
                    class="u-active-palette-1-base u-field-input u-grey-25 u-radius-3"
                    data-calc="false"
                  />
                  <label class="u-field-label" for="field-e7f9">Low carb</label>
                </div>
                <div class="u-input-row">
                  <input
                    id="field-0cfb"
                    type="checkbox"
                    name="options[]"
                    value="false"
                    class="u-active-palette-1-base u-field-input u-grey-25 u-radius-3"
                    data-calc="false"
                  />
                  <label class="u-field-label" for="field-0cfb"
                    >Gluten Free</label
                  >
                </div>
                <div class="u-input-row">
                  <input
                    id="field-ee71"
                    type="checkbox"
                    name="options[]"
                    value="false"
                    class="u-active-palette-1-base u-field-input u-grey-25 u-radius-3"
                    data-calc="false"
                  />
                  <label class="u-field-label" for="field-ee71"
                    >Dairy Free</label
                  >
                </div>
              </div>
            </div>
            <div class="u-align-right u-form-group u-form-submit u-label-none">
              <input
                type="submit"
                value="submit"
                class="u-border-none u-btn u-btn-submit u-button-style u-palette-3-base u-radius-15 u-btn-1"
              />
            </div>
            <img
              src="./images/top.png"
              alt="top of cloche"
              id="cloche-top"
              style="display: none"
              class="cloche"
            />
          </form>
        </div>

        <img
          src="./images/loading.gif"
          alt="loading sign"
          id="loading"
          style="display: none"
          class="cloche"
        />
        <h6 class="u-text" id="response"></h6>
        <p class="u-text" id="response-why"></p>
        <img
          src="./images/bottom.png"
          alt="bottom of cloche"
          id="cloche-bottom"
          style="display: none"
          class="cloche"
        />
      </div>
    </section>

    <footer
      class="u-align-center u-clearfix u-footer u-grey-80 u-footer"
      id="sec-9b79"
    >
      <div class="u-clearfix u-sheet u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1">
          Copyright BetterBites 2023
        </p>
      </div>
    </footer>
    <script defer>
      var userLocation = "";
      const form = document.getElementById("betterbites-form");
      form.addEventListener("submit", (e) => {
        e.preventDefault();

        document.getElementById("loading").style = "display: block;";

        const options = {
          food: document.getElementById("name-8fe3").value,
          lowCarb: document.getElementById("field-e7f9").checked,
          glutenFree: document.getElementById("field-0cfb").checked,
          dairyFree: document.getElementById("field-ee71").checked,
        };

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              userLocation = `${position.coords.latitude}, ${position.coords.longitude}`;
              fetchAlternatives(options);
            },
            (error) => {
              console.log(error);
              fetchAlternatives(options);
            }
          );
        } else {
          console.log("Geolocation is not supported by this browser.");
          fetchAlternatives(options);
        }
      });

      const fetchLocation = async (food) => {
        if ((userLocation = "")) return "not found";
        const response = await fetch("http://1.gpu.garden:8337/near", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ food, location: userLocation }),
        });

        const responseJSON = await response.json();
        console.log(responseJSON);
        if (!responseJSON.place) {
          return "not found";
        } else {
          return `${responseJSON.place}, ${responseJSON.address}`;
        }
      };

      const fetchAlternatives = async (food) => {
        const response = await fetch("http://1.gpu.garden:8337/alternative", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(food),
        });

        const responseJSON = await response.json();
        const why = responseJSON.why;
        const newFood = responseJSON.alternative_food;
        const old = responseJSON.old_food;
        const nutritionOld = responseJSON.nutrition_facts.old;
        const nutritionNew = responseJSON.nutrition_facts.new;
        const location = await fetchLocation(newFood);

        const responseEl = document.getElementById("response");
        const responseParagraph = document.getElementById("response-why");

        document.getElementById("loading").style = "display: none;";
        document.getElementById("cloche-top").style = "display: block;";
        document.getElementById("cloche-bottom").style = "display: block;";

        responseEl.innerText = `Your alternative food: ${newFood}

        Nearest place to buy it: ${location}
        `;

        responseParagraph.innerText = `Why?: ${why}

        Average nutrition facts of a serving of ${old}:
        Calories: ${nutritionOld.calories}
        Fat: ${nutritionOld.total_fat}

        Average nutrition facts of a serving of ${newFood}:
        Calories: ${nutritionNew.calories}
        Fat: ${nutritionNew.total_fat}
        `;
      };
    </script>
    <style>
      .response {
        font-weight: 500 !important;
      }

      .cloche {
        width: 40%;
        margin: 0 auto;
      }
    </style>
  </body>
</html>
